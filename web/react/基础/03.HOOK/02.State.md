[TOC]

---

### 一、简介

是一个在函数组件中使用的函数，用于在函数中使用装态。

useState 函数有一个参数，这个参数的值表示状态的默认值

- 函数的返回值是一个数组，该数组一定包含两项
  - 第一项：当前状态的值
  - 第二项：改变状态的函数

一个函数组件中可以有多个状态，这种做法非常有利于横向切分关注点。

例如：

```JS
var [n, setN] = useState(0);
```

```HTML
<button
  onClick={() => {
    setN(n - 1);
  }}
>
  -
</button>
```

### 二、原理

1. 第 N 次调用 useState
2. 检查该节点的状态数组是否存在下标 N
3. 不存在
   1. 使用默认值创建一个状态
   2. 将该状态加入到状态数组中，下标为 0
4. 存在
   1. 忽略掉默认值。
   2. 直接得到状态值

**注意细节**

1. useState 最好写到函数的起始位置，便于阅读
2. useState 严禁出现在代码块（判断，循环）中
3. useState 返回的函数（数组第二项），引用不变（节约内存空间）
4. 如果使用函数改变数据，若数据和之前的数据完全相等（使用 Object.is 比较），不会导致重新徐渲染。已达到优化效率的目的。
5. 使用函数改变数据，传入的值不会和原来的数据进行合并，而是直接替换。
6. 如果要实现强制刷新组件
   1. 类组件：使用 forceUpdate 函数 （不会运行 shouldComponentUpdate 生命周期函数 ）
   2. 函数组件：使用一个空对象的 useState
   ```JS
   const [, forceUpdate] = useState({})
   <button onClick={() => { forceUpdate({}) }}>重新渲染</button>
   ```
7. **如果某些状态之间没有必然的联系，应该分化为不同的状态，而不要合并成一个对象。**
8. 和类组件的状态一样，函数组件中改变状态可能是异步的（在 DOM 事件中），多个状态变化会合并以提高效率，此时不能信任之前的状态，而应该使用回调函数改变状态。

```JS
setState(pre => pre + 1);
```
